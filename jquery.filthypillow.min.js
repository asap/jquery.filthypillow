(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof exports?module.exports=c:c(jQuery)})(function(c){function h(a,b){var f=c.extend({},k.calendar,b.calendar||{});this.options=c.extend({},k,b);this.options.calendar=f;this.$element=a;this.setup()}function d(a,b){this.options=c.extend({},b);this.date=moment();this.$element=a;this.currentTimeZone=null;this.$container=c('<div class="fp-cal-container"><div class="fp-cal-nav"><span class="fp-cal-left">&#9668;</span><span class="fp-cal-month"></span><span class="fp-cal-right">&#9658;</span></div><table><thead><tr class="fp-cal-days"></tr></thead><tbody class="fp-cal-dates"></tbody></div></div>');
this.$left=this.$container.find(".fp-cal-left");this.$right=this.$container.find(".fp-cal-right");this.$month=this.$container.find(".fp-cal-month");this.$days=this.$container.find(".fp-cal-days");this.$dates=this.$container.find(".fp-cal-dates");this.$dateTemplate=c('<td class="fp-cal-date" data-date=""></td>');this.$weekTemplate=c('<tr class="fp-cal-week"></tr>');this.$dayLabelTemplate=c('<th class="fp-cal-day-label"></th>');this.buildDayLabels()}var k={startStep:"day",minDateTime:null,maxDateTime:null,
initialDateTime:null,enableCalendar:!0,steps:["month","day","hour","minute","meridiem"],exitOnBackgroundClick:!0,calendar:{isPinned:!1,saveOnDateSelect:!1}},l="show hide destroy updateDateTime updateDateTimeUnit setTimeZone".split(" "),m=["getDate","isValid"];h.prototype={template:'<div class="fp-container"><div class="fp-calendar"><span class="fp-month fp-option"></span>/<span class="fp-day fp-option"></span></div><div class="fp-clock"><span class="fp-hour fp-option"></span>:<span class="fp-minute fp-option"></span><span class="fp-meridiem fp-option"></span></div><div class="fp-save"><button class="btn btn-primary fp-save-button">Save</button></div><div class="fp-description"></div><div class="fp-errors"></div><div class="fp-calendar-calendar"></div></div>',
currentStep:null,dateTime:null,currentTimeZone:null,currentDigit:0,isActiveLeadingZero:0,stepRegExp:null,isError:!1,isActive:!1,setup:function(){this.steps=this.options.steps;this.stepRegExp=new RegExp(this.steps.join("|"));this.$window=c(window);this.$document=c(document);this.$body=c("body");this.id="filthypillow-"+Math.round(1E3*Math.random());this.$container=c(this.template);this.$container.attr("id",this.id);this.$calendar=this.$container.find(".fp-calendar");this.$options=this.$container.find(".fp-option");
this.$month=this.$calendar.find(".fp-month");this.$day=this.$calendar.find(".fp-day");this.$clock=this.$container.find(".fp-clock");this.$hour=this.$clock.find(".fp-hour");this.$minute=this.$clock.find(".fp-minute");this.$meridiem=this.$clock.find(".fp-meridiem");this.$errorBox=this.$container.find(".fp-errors");this.$saveButton=this.$container.find(".fp-save-button");this.$descriptionBox=this.$container.find(".fp-description");this.options.enableCalendar&&(this.calendar=new d(this.$container.find(".fp-calendar-calendar"),
{minDateTime:this.options.minDateTime,maxDateTime:this.options.maxDateTime,onSelectDate:c.proxy(function(a,b,f,c){this.updateDateTimeUnit("month",b,!1);this.updateDateTimeUnit("date",f,!1);this.updateDateTimeUnit("year",a,!1);this.options.calendar.saveOnDateSelect&&c.activeDateClicked&&this.$saveButton.click()},this)}));this.setInitialDateTime()},showError:function(a,b){this["$"+a].addClass("fp-error fp-out-of-range");this.$errorBox.text(b).show();this.$saveButton.attr("disabled","disabled");this.isError=
!0},hideError:function(a,b){this.$container.find(".fp-error").removeClass("fp-error");this.$errorBox.hide();this.$saveButton.removeAttr("disabled","disabled");this.isError=!1},activateSelectorTool:function(a){var b=this["$"+a];this.currentStep=a;this.$container.find(".active").removeClass("active");b.addClass("active");this.isActiveLeadingZero=this.currentDigit=0;this.options.enableCalendar&&("day"===a||"month"===a?this.calendar.show():this.options.calendar.isPinned||this.calendar.hide())},to12Hour:function(a){return"PM"===
this.dateTime.format("A")&&12<a?a-12:a},to24Hour:function(a){return"PM"===this.dateTime.format("A")&&12>a?a+12:"AM"===this.dateTime.format("A")&&11<a?a-12:a},formatToMoment:function(a,b){return"month"===a?b-1:b},formatFromMoment:function(a,b){return"month"===a?b+1:b},isValidDigitInput:function(a){a=parseInt(a,10);if("month"===this.currentStep){if(12<a)return!1}else if("day"===this.currentStep&&a>this.dateTime.daysInMonth())return!1;return!0},updateDigit:function(a,b,f){var c,d=!1;"meridiem"!==a&&
("day"===a&&(a="date"),1===b&&0===f?this.isActiveLeadingZero=1:(2!==b||this.isActiveLeadingZero?this.isActiveLeadingZero=0:(b=this.dateTime.get(a),b="hour"===a?this.to12Hour(b):this.formatFromMoment(a,b),c=parseInt(b+""+f,10)),c=c||f,c="hour"===a?this.to24Hour(c):this.formatToMoment(a,c),this.isValidDigitInput(c)?(2===this.currentDigit?d=!0:"month"===a&&1<f?d=!0:"date"===a&&3<f?d=!0:"hour"===a&&1<f?d=!0:"minute"===a&&5<f&&(d=!0),this.updateDateTimeUnit(a,c,d)):2===this.currentDigit&&(this.currentDigit=
1)))},onOptionClick:function(a){(a=c(a.target).attr("class").match(this.stepRegExp))&&a.length&&this.activateSelectorTool(a[0])},onKeyUp:function(a){a=a.keyCode||a.which;if("meridiem"!==this.currentStep){8===a&&--this.currentDigit;if(48<=a&&57>=a||96<=a&&105>=a)this.currentDigit+=1,this.updateDigit(this.currentStep,this.currentDigit,a%48);2===this.currentDigit&&(this.currentDigit=0)}},onKeyDown:function(a){var b=a.keyCode||a.which;switch(b){case 38:this.moveUp();break;case 40:this.moveDown();break;
case 37:this.moveLeft();break;case 39:this.moveRight()}a.shiftKey&&9===b?this.moveLeft():9===b&&this.moveRight();13===b&&this.$saveButton.click();return!1},moveDown:function(){if("meridiem"===this.currentStep){var a=12>this.dateTime.format("H")?12:-12;this.changeDateTimeUnit("hour",a)}else"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,-15):this.currentStep&&this.changeDateTimeUnit(this.currentStep,-1);this.currentDigit=0},moveUp:function(){if("meridiem"===this.currentStep){var a=
12>parseInt(this.dateTime.format("H"),10)?12:-12;this.changeDateTimeUnit("hour",a)}else"minute"===this.currentStep?this.changeDateTimeUnit(this.currentStep,15):this.currentStep&&this.changeDateTimeUnit(this.currentStep,1);this.currentDigit=0},moveLeft:function(){if(this.currentStep){var a=this.steps.indexOf(this.currentStep);0===a?a=this.steps.length-1:--a;this.activateSelectorTool(this.steps[a])}},moveRight:function(){if(this.currentStep){var a=this.steps.indexOf(this.currentStep),a=a===this.steps.length-
1?0:a+1;this.activateSelectorTool(this.steps[a])}},onClickToExit:function(a){a=c(a.target);/fp-/.test(a.attr("class"))||a.closest(this.$container).length||a.closest(this.$element).length||this.hide()},onSave:function(){this.isInRange(this.dateTime)&&this.$element.trigger("fp:save",[this.dateTime])},addEvents:function(){this.$options.on("click",c.proxy(this.onOptionClick,this));this.$saveButton.on("click",c.proxy(this.onSave,this));this.$document.on("keydown."+this.id,c.proxy(this.onKeyDown,this));
this.$document.on("keyup."+this.id,c.proxy(this.onKeyUp,this));if(this.options.exitOnBackgroundClick)this.$window.on("click."+this.id,c.proxy(this.onClickToExit,this))},removeEvents:function(){this.$options.off("click");this.$saveButton.off("click");this.$window.off("click."+this.id);this.$document.off("keydown."+this.id);this.$document.off("keyup."+this.id)},setDateTime:function(a,b){this.dateTime=moment(a);this.options.enableCalendar&&this.calendar.setDate(this.dateTime);this.isInRange(this.dateTime)?
this.isError&&this.hideError():this.showError(this.currentStep,"Date is out of range, please fix.");!this.isError&&b&&this.moveRight()},renderDateTime:function(){this.$month.text(this.dateTime.format("MM"));this.$day.text(this.dateTime.format("DD"));this.$hour.text(this.dateTime.format("hh"));this.$minute.text(this.dateTime.format("mm"));this.$meridiem.text(this.dateTime.format("A"));this.$descriptionBox.text(this.dateTime.format("LLLL"))},setInitialDateTime:function(){var a=moment();a.format("m");
a.zone(this.currentTimeZone);"function"===typeof this.options.initialDateTime&&(a=this.options.initialDateTime(a.clone()));this.updateDateTime(a)},isInRange:function(a){var b="function"===typeof this.options.minDateTime&&this.options.minDateTime(),c="function"===typeof this.options.maxDateTime&&this.options.maxDateTime(),d=right=!1;b&&(b.zone(this.currentTimeZone),d=0>a.diff(b,"second"));c&&(c.zone(this.currentTimeZone),right=0<a.diff(c,"second"));return!(right||d)},setTimeZone:function(a){this.dateTime.zone(a);
this.currentTimeZone=a;this.options.enableCalendar&&this.calendar.setTimeZone(a)},dateChange:function(){this.options.enableCalendar&&(this.calendar.setDate(this.dateTime),"day"!==this.currentStep&&"month"!==this.currentStep||this.calendar.render())},changeDateTimeUnit:function(a,b){var c=this.dateTime.clone().add(b,a+"s"),c=this.isInRange(c);if(this.isError||c)c&&this.hideError(),this.dateTime.add(b,a+"s"),this.renderDateTime(),this.dateChange(),this.$element.trigger("fp:datetimechange",[this.dateTime])},
updateDateTimeUnit:function(a,b,c){a=this.dateTime.clone().set(a,b);this.updateDateTime(a,c)},getDate:function(){return this.dateTime.clone()},isValid:function(){return!this.isError},updateDateTime:function(a,b){this.setDateTime(a,b);this.renderDateTime();this.dateChange()},show:function(){this.isActive||(this.setInitialDateTime(),this.$container.insertAfter(this.$element),this.activateSelectorTool(this.options.startStep),this.addEvents(),this.isActive=!0)},hide:function(){this.isActive&&(this.$container.remove(),
this.removeEvents(),this.isActive=!1)},destroy:function(){this.removeEvents();this.$container.remove();this.isActive=!1;this.$element.removeData("plugin_filthypillow")}};d.prototype.setDate=function(a){this.date=a.clone()};d.prototype.removeEvents=function(){this.$right.off("click");this.$left.off("click");this.$dates.find(".fp-cal-date:not( .fp-disabled )").off("click")};d.prototype.addEvents=function(){this.$right.on("click",c.proxy(this.nextMonth,this));this.$left.on("click",c.proxy(this.prevMonth,
this));this.$dates.find(".fp-cal-date:not( .fp-disabled )").on("click",c.proxy(this.onSelectDate,this))};d.prototype.toggleMonthArrows=function(){this.isInMinRange(this.date.clone().subtract(1,"month").endOf("month"))?this.$left.show():this.$left.hide();this.isInMaxRange(this.date.clone().add(1,"month").date(1))?this.$right.show():this.$right.hide()};d.prototype.nextMonth=function(){this.date.add(1,"month");this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date"));this.render()};
d.prototype.prevMonth=function(){this.date.subtract(1,"month");this.selectDate(this.date.get("year"),this.date.get("month"),this.date.get("date"));this.render()};d.prototype.selectDate=function(a,b,c,d){if("function"===typeof this.options.onSelectDate)this.options.onSelectDate(a,b,c,d||{});this.highlightDate(c)};d.prototype.onSelectDate=function(a){a=c(a.target);var b=parseInt(a.attr("data-add-month"),10);this.date.add(b,"month");this.selectDate(this.date.get("year"),this.date.get("month"),a.attr("data-date"),
{activeDateClicked:!b})};d.prototype.highlightDate=function(a){this.$dates.find(".active").removeClass("active");this.$dates.find(".fp-cal-date-"+a).addClass("active")};d.prototype.buildTemplate=function(){this.$month.text(this.date.format("MMMM YYYY")).attr("data-month",this.date.get("month")+1);this.toggleMonthArrows();this.buildDates();this.disableOutOfRangeDates();this.highlightDate(this.date.get("date"))};d.prototype.isInMinRange=function(a){if("function"!==typeof this.options.minDateTime)return!0;
var b=this.options.minDateTime();b.zone(this.currentTimeZone);return 0<a.diff(b,"second")};d.prototype.isInMaxRange=function(a){if("function"!==typeof this.options.maxDateTime)return!0;var b=this.options.maxDateTime();b.zone(this.currentTimeZone);return 0>a.diff(b,"second")};d.prototype.disableOutOfRangeDates=function(){var a=this,b,d;"function"!==typeof a.options.maxDateTime&&"function"!==typeof a.options.minDateTime||this.$dates.find(".fp-cal-date").filter(function(){b=a.date.clone();d=c(this);
d.attr("data-add-month")&&b.add(d.attr("data-add-month"),"month");b.date(c(this).attr("data-date"));return!(a.isInMinRange(b)&&a.isInMaxRange(b))}).addClass("fp-disabled")};d.prototype.buildDayLabels=function(){for(var a=this.date.clone(),b=0;7>b;++b)this.$dayLabelTemplate.clone().text(a.day(b).format("ddd")).appendTo(this.$days)};d.prototype.buildDates=function(){var a=this.date.daysInMonth(),b=this.date.clone(),c=this.date.clone().subtract(1,"month").endOf("month").date(),d=this.$weekTemplate.clone(),
g=b.date(1).weekday(),b=b.date(a).weekday(),e;this.$dates.empty();for(e=0;e<g;++e)this.$dateTemplate.clone().attr("data-add-month",-1).attr("data-date",c-e).addClass("fp-cal-date-prev-"+c-e).addClass("fp-not-in-month").text(c-e).prependTo(d);for(e=1;e<=7-g;++e)this.$dateTemplate.clone().addClass("fp-cal-date-"+e).attr("data-date",e).text(e).appendTo(d);d.appendTo(this.$dates);d=this.$weekTemplate.clone();for(d.appendTo(this.$dates);e<=a;++e)0===(e+g-1)%7&&(d=this.$weekTemplate.clone(),d.appendTo(this.$dates)),
this.$dateTemplate.clone().addClass("fp-cal-date-"+e).attr("data-date",e).text(e).appendTo(d);for(e=1;e<7-b;++e)this.$dateTemplate.clone().addClass("fp-cal-date-next-"+e).attr("data-add-month",1).attr("data-date",e).addClass("fp-not-in-month").text(e).appendTo(d)};d.prototype.render=function(){this.buildTemplate();this.removeEvents();this.addEvents()};d.prototype.show=function(){this.render();this.$container.appendTo(this.$element)};d.prototype.hide=function(){this.$container.remove();this.removeEvents()};
d.prototype.get=function(){return this.$container};d.prototype.setTimeZone=function(a){this.currentTimeZone=a};c.fn.filthypillow=function(a){var b,d=Array.prototype.slice.call(arguments);a=a||{};return"string"===(typeof a).toLowerCase()&&~c.inArray(a,m)?this.data("plugin_filthypillow")[a].apply(this.data("plugin_filthypillow"),d.slice(1,d.length)):this.each(function(){b=c(this);if(!b.data("plugin_filthypillow")&&"object"===(typeof a).toLowerCase())b.data("plugin_filthypillow",new h(b,a));else if("string"===
(typeof a).toLowerCase())if(~c.inArray(a,l))b.data("plugin_filthypillow")[a].apply(b.data("plugin_filthypillow"),d.slice(1,d.length));else throw Error("Method "+a+" does not exist. Did you instantiate filthypillow?");})}});
